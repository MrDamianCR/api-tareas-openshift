<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>API de Tareas en OpenShift</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 0 16px;
        background: #0b1120;
        color: #e5e7eb;
      }

      h1 {
        margin-bottom: 8px;
      }

      .muted {
        color: #9ca3af;
        margin-bottom: 24px;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 24px;
        padding: 16px;
        border-radius: 8px;
        background: #020617;
        border: 1px solid #1f2937;
      }

      label {
        font-size: 14px;
        color: #d1d5db;
      }

      input,
      textarea {
        padding: 8px 10px;
        border-radius: 6px;
        border: 1px solid #374151;
        background: #020617;
        color: #e5e7eb;
        font: inherit;
      }

      button {
        align-self: flex-start;
        padding: 8px 14px;
        border-radius: 6px;
        border: none;
        font: inherit;
        cursor: pointer;
        background: #22c55e;
        color: #022c22;
        font-weight: 600;
      }

      button:hover {
        filter: brightness(1.1);
      }

      ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .tarea {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 8px;
        padding: 10px 12px;
        border-radius: 8px;
        background: #020617;
        border: 1px solid #1f2937;
      }

      .tarea h3 {
        margin: 0 0 4px 0;
        font-size: 15px;
      }

      .tarea p {
        margin: 0;
        font-size: 13px;
        color: #9ca3af;
      }

      .tarea small {
        font-size: 11px;
        color: #6b7280;
      }

      .tarea button {
        background: #ef4444;
        color: #fee2e2;
        padding: 6px 10px;
        font-size: 12px;
      }

      #estado {
        margin-top: 12px;
        font-size: 13px;
        min-height: 18px;
      }
    </style>
  </head>
  <body>
    <h1>Gestión de tareas</h1>
    <p class="muted">
      Ejemplo de aplicación desplegada en una PaaS (OpenShift). La interfaz habla
      con la API <code>/tareas</code>.
    </p>

    <form id="form-tarea">
      <div>
        <label for="titulo">Título de la tarea</label>
        <input id="titulo" name="titulo" required />
      </div>

      <div>
        <label for="descripcion">Descripción</label>
        <textarea id="descripcion" name="descripcion" rows="2"></textarea>
      </div>

      <button type="submit">Añadir tarea</button>
      <div id="estado"></div>
    </form>

    <h2>Lista de tareas</h2>
    <ul id="lista-tareas"></ul>

    <script>
      const lista = document.getElementById("lista-tareas");
      const form = document.getElementById("form-tarea");
      const estado = document.getElementById("estado");

      async function cargarTareas() {
        estado.textContent = "Cargando tareas...";
        try {
          const res = await fetch("/tareas");
          const datos = await res.json();
          renderTareas(datos);
          estado.textContent = "";
        } catch (err) {
          console.error(err);
          estado.textContent = "Error al cargar las tareas.";
        }
      }

      function renderTareas(tareas) {
        lista.innerHTML = "";
        if (tareas.length === 0) {
          const li = document.createElement("li");
          li.textContent = "No hay tareas.";
          li.classList.add("muted");
          lista.appendChild(li);
          return;
        }

        tareas.forEach((t) => {
          const li = document.createElement("li");
          li.className = "tarea";

          const info = document.createElement("div");
          const titulo = document.createElement("h3");
          titulo.textContent = t.titulo;

          const desc = document.createElement("p");
          desc.textContent = t.descripcion || "Sin descripción";

          const meta = document.createElement("small");
          meta.textContent = `ID: ${t.id}`;

          info.appendChild(titulo);
          info.appendChild(desc);
          info.appendChild(meta);

          const btn = document.createElement("button");
          btn.textContent = "Eliminar";
          btn.onclick = async () => {
            try {
              await fetch(`/tareas/${t.id}`, { method: "DELETE" });
              cargarTareas();
            } catch (err) {
              console.error(err);
              estado.textContent = "Error al eliminar la tarea.";
            }
          };

          li.appendChild(info);
          li.appendChild(btn);
          lista.appendChild(li);
        });
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const titulo = document.getElementById("titulo").value.trim();
        const descripcion = document
          .getElementById("descripcion")
          .value.trim();

        if (!titulo) return;

        estado.textContent = "Creando tarea...";

        try {
          await fetch("/tareas", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ titulo, descripcion }),
          });

          form.reset();
          estado.textContent = "Tarea creada.";
          cargarTareas();
        } catch (err) {
          console.error(err);
          estado.textContent = "Error al crear la tarea.";
        }
      });

      // Carga inicial
      cargarTareas();
    </script>
  </body>
</html>
